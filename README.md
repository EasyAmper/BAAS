# Введение

BAAS - Bell Automatic Activation System (Система автоматической подачи звонков). 

Основное назначение проекта - точная подача звонков (в учебных заведениях) в назначенное время, без вмешательства человека. 

Программа обновляет время с помощью NTP и способна вести его самостоятельно при сбоях подключения к интернету. 
Все это реализовано силами ESP8266. Среди версий есть варианты предусматривающие разное редактирование расписания ( набор устройств отличается ).

За множество полезных, используемых в проекте библиотек, спасибо [AlexGyver](https://alexgyver.ru/).

Это уже 4 версия данного проекта. В нем объединены два способа задания звонка. Теперь это можно делать и через веб интерфейс, и через SD карту.

# Реализация

Необходимые элементы:

* контроллер на базе esp8266;
* реле на 5v включающиеся по низкому уровню;
* SPI карт-ридер для SD карт;
* прямые руки.

# Использование

Перед началом работы необходимо в файле [a1_data.ino](BAAS_v4/a1_data.ino) ввести данные вашей сети:

```CPP
const char *ssid     = "";		    // Логин к вашему WI-FI
const char *password = "";        // Пароль от WI-FI
```

Там же указать ip адрес вашего роутера (шлюз) и адрес вашего устройства. "192.168.1.***" три числа как у шлюза и 4 свой. Главное чтобы не совпадал с другим устройством (см. в настройках роутера). Маска подсети остается неизменной. ДНС можно заменить на любой другой.

```CPP
IPAddress ip(192,168,1,44);			  //адрес подключения к плате
IPAddress gateway(192,168,1,1); 	//шлюз
IPAddress subnet(255,255,255,0);	//маска подсети
IPAddress dns(1,1,1,1);           //днс
```

Для доступа к веб интерфейсу отредактируйте и запомните пароль в том же файле

```CPP
int pagepass = 12345;
```

### SD card

Данный способ является дополнительным и не обязательным к физической реализации.

Для начала необходимо сгенерировать `call.json` при помощи небольшой [утилиты](WEB/call_page.html), открываемой с помощью браузера.

После этого данный файл перекидывается на SD карту, а SD карта втыкается в ридер SD карт. При запуске данные с карты записываются в EEPROM (если данные EEPROM совпадают с данными на карте, то ресурс запесей не тратится)

### WEB интерфейс

Для его открытия необходимо перейти по адресу платы указанного при прошивке (ссылка будет выведена в порт). После изменений времени звонков введите пароль и нажмите принять изменения. EEPROM будет перезаписан.

# Версии

Переключаясь по веткам можно обнаружить различные вариации исходного кода. Далее представлено краткое описание этих вариаций.

BAAS - исходная версия. Довольно топорная, много нехороших вещей, таких как Delay. Автор EASYAMPER. 

BAAS v2 - Готовая версия с хранением расписания на SD карте, организован аварийный счет дней недели, delay еще используется. Автор [Darth Kuli](https://github.com/DarthVader904). 

BAAS v3 - Хранение данных в EEPROM ESP, обновление расписания с помощью интернет-страницы в локальной сети, delay больше нет. Автор EASYAMPER. 

BAAS v4 - Последняя актуальная версия. Хранение данных осуществляется в EEPROM. Их обновление возможно с SD карты (при запуске) или при помощи веб интерфейса GyverPortal (во время работы).
